/*
===============================================================================
Quality Checks
===============================================================================
Script Purpose:
    This script performs various quality checks for data consistency, accuracy, 
    and standardization across the 'silver' layer. It includes checks for:
    - Null or duplicate primary keys.
    - Unwanted spaces in string fields.
    - Data standardization and consistency.
    - Invalid date ranges and orders.
    - Data consistency between related fields.

Usage Notes:
    - Run these checks after data loading Silver Layer.
    - Investigate and resolve any discrepancies found during the checks.
===============================================================================
*/


-- Check for nulls or duplicates in the primary key
-- Expectation : No result


select
	cst_id,
	COUNT(*)
from silver.crm_cust_info
group by cst_id
having COUNT(*) > 1 or cst_id is Null;

-- Check for Unwanted Spaces
-- Expectation : No result

select cst_firstname
from silver.crm_cust_info
where cst_firstname != TRIM(cst_firstname);

select cst_lastname
from silver.crm_cust_info
where cst_lastname != TRIM(cst_lastname);


-- Data Standardisation & Consistency

select DISTINCT cst_gndr from silver.crm_cust_info;


select * from silver.crm_cust_info;
select * from silver.crm_prd_info



select
	prd_id,
	COUNT(*)
from silver.crm_prd_info
group by prd_id
having COUNT(*) > 1 or prd_id is Null;


select prd_nm
from silver.crm_prd_info
where prd_nm != TRIM(prd_nm);

select prd_cost
from silver.crm_prd_info
where prd_cost<0 or prd_cost is null


select *
from silver.crm_prd_info
where prd_end_dt < prd_start_dt		--dates where end dates are before the start date


-- Check for invalid date format/order
--Order Dt
select 
NULLIF (sls_order_dt,0)
from silver.crm_sales_details
where LEN(sls_order_dt) < 8 or sls_order_dt <= 0

--Ship dt
select 
NULLIF (sls_ship_dt,0)
from silver.crm_sales_details
where LEN(sls_ship_dt) < 8 or sls_ship_dt <= 0

--Due dt
select 
NULLIF (sls_due_dt,0)
from silver.crm_sales_details
where LEN(sls_due_dt) < 8 or sls_due_dt <= 0

Select *
from silver.crm_sales_details
where sls_order_dt > sls_due_dt or sls_order_dt > sls_ship_dt

--Check for sales price nulls or 0 or negative
Select distinct
sls_sales,
sls_quantity,
sls_price
from silver.crm_sales_details
where sls_sales != sls_quantity * sls_price
or sls_price is null or sls_quantity is null or sls_sales is null
or sls_price <= 0 or sls_quantity <= 0 or sls_sales <= 0

--Check for data quality in erp.cust table

select
distinct len(bdate)
from silver.erp_cust_az12

select *
from silver.erp_cust_az12
where bdate > GETDATE() or bdate < '1925-01-01'

select
gen,
CASE
	When UPPER(TRIM(gen)) in ('M','MALE') then 'Male'
	When UPPER(TRIM(gen)) in ('F','FEMALE') then 'Female'
	Else 'n/a'
END as gen
from silver.erp_cust_az12


select 
distinct gen
from silver.erp_cust_az12


select 
cid,
cntry
from bronze.erp_loc_a101

--Checking data consistency in erp_loc table
select distinct 
cntry
from silver.erp_loc_a101


--Checking data consistency in erp_px_cat_g1v2 table

select * from silver.erp_px_cat_g1v2;
