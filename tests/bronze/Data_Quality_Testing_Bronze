-- Check for nulls or duplicates in the primary key
-- Expectation : No result
select
	cst_id,
	COUNT(*)
from bronze.crm_cust_info
group by cst_id
having COUNT(*) > 1 or cst_id is Null;

-- Check for Unwanted Spaces
-- Expectation : No result

select cst_firstname
from bronze.crm_cust_info
where cst_firstname != TRIM(cst_firstname);

select cst_lastname
from bronze.crm_cust_info
where cst_lastname != TRIM(cst_lastname);


-- Data Standardisation & Consistency

select DISTINCT cst_gndr from bronze.crm_cust_info;


-- Check for nulls or duplicates in the primary key
-- Expectation : No result
select
	prd_id,
	COUNT(*)
from bronze.crm_prd_info
group by prd_id
having COUNT(*) > 1 or prd_id is Null;


-- Check for Unwanted Spaces
-- Expectation : No result

select prd_nm
from bronze.crm_prd_info
where prd_nm != TRIM(prd_nm);

-- Check for negative/null costs
-- Expectation : No result

select prd_cost
from bronze.crm_prd_info
where prd_cost<0 or prd_cost is null


-- Check for invalid date format/order

select *
from bronze.crm_prd_info
where prd_end_dt < prd_start_dt		--dates where end dates are before the start date



-- Check for invalid date format/order
--Order Dt
select 
NULLIF (sls_order_dt,0)
from bronze.crm_sales_details
where LEN(sls_order_dt) < 8 or sls_order_dt <= 0

--Ship dt
select 
NULLIF (sls_ship_dt,0)
from bronze.crm_sales_details
where LEN(sls_ship_dt) < 8 or sls_ship_dt <= 0

--Due dt
select 
NULLIF (sls_due_dt,0)
from bronze.crm_sales_details
where LEN(sls_due_dt) < 8 or sls_due_dt <= 0

Select *
from bronze.crm_sales_details
where sls_order_dt > sls_due_dt or sls_order_dt > sls_ship_dt

--Check for sales price nulls or 0 or negative
Select distinct
sls_quantity,
sls_price,
CASE
	When sls_price <=0 or sls_price is null then sls_sales/NULLIF(sls_quantity,0)
	Else sls_price
END as sls_price_new,
sls_sales,
CASE
	When sls_sales <= 0 or sls_sales is null or sls_sales != sls_quantity * ABS(sls_price) then sls_quantity * ABS(sls_price)
	Else sls_sales
END as sls_sales_new
from bronze.crm_sales_details
where sls_price != sls_quantity * sls_sales
or sls_price is null or sls_quantity is null or sls_sales is null
or sls_price <= 0 or sls_quantity <= 0 or sls_sales <= 0



--Check for birthday out of range
select
distinct len(bdate)
from bronze.erp_cust_az12

select *
from bronze.erp_cust_az12
where bdate > GETDATE() or bdate < '1925-01-01'

select
gen,
CASE
	When UPPER(TRIM(gen)) in ('M','MALE') then 'Male'
	When UPPER(TRIM(gen)) in ('F','FEMALE') then 'Female'
	Else 'n/a'
END as gen
from bronze.erp_cust_az12


select 
cid,
cntry
from bronze.erp_loc_a101

--Checking data consistency in erp_loc table
select distinct 
--cntry,
CASE
	When TRIM(cntry) = 'DE' then 'Germany'
	When TRIM(cntry) in ('US','USA') then 'United States'
	When TRIM(cntry) = '' or cntry is Null then 'n/a'
	Else TRIM(cntry)
END as cntry
from bronze.erp_loc_a101


select 
distinct cid,
REPLACE(cid,'-','')
from bronze.erp_loc_a101

select distinct cst_key from silver.crm_cust_info



--Testing data consitencies in erp_px_cat_g1v2 table
select
	id,
	cat,
	subcat,
	maintainance
from bronze.erp_px_cat_g1v2;

select * from bronze.erp_px_cat_g1v2
where id != TRIM(id) or cat != TRIM(cat) or subcat != TRIM(subcat)


